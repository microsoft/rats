# THIS FILE WAS GENERATED BY IMMUNODATA PLATFORM LIBRARIES.
# EDIT WITH CAUTION!

parameters:
  - name: builderImage
    type: string
  - name: project
    type: string
  - name: namespace
    type: string
    values:
    - "production"
    - "ci-pr-builds"

jobs:
- job:
  displayName: "Build CD: Dataset Markers"
  pool:
    vmImage: "ubuntu-latest"

  steps:
  - checkout: self
    submodules: true
  - template: /.azure-pipelines/templates/steps.authenticate.yaml
  # This one does not depend on components or anything
  - template: /.azure-pipelines/templates/steps.define-build-variable.build-branch.yaml

  - template: /.azure-pipelines/templates/steps.immunodata-app-builder.command.yaml
    parameters:
      builderImage: ${{ parameters.builderImage }}
      command: >-
        immunocli-next
        -vvv ci
        publish-build-marker ${{ parameters.project }}
        --dataset-namespace ${{ parameters.namespace }}
        --dataset-user azure-devops@managed-identity
        --dataset-branch $BUILD_BRANCH
        --dataset-partition $(Build.Buildnumber)
      name: Publish Build Marker
