# THIS FILE WAS GENERATED BY IMMUNODATA PLATFORM LIBRARIES.
# EDIT WITH CAUTION!

parameters:
  - name: appBuilderImageName
    type: string
  - name: appBuilderImageTag
    type: string
  - name: component
    type: string
    values:
    - oneml-devtools
    - oneml-habitats
    - oneml-pipelines
    - oneml-processors
  - name: kernel_class
    type: string

jobs:
- job:
  displayName: "Build CD: Jupyter Kernel Deploy"
  pool:
    vmImage: "ubuntu-latest"

  steps:
  - checkout: self
    submodules: true
  - template: /.azure-pipelines/templates/steps.authenticate.yaml
  - template: /.azure-pipelines/templates/steps.define-build-variables.yaml
    parameters:
      appBuilderImageName: ${{ parameters.appBuilderImageName }}
      appBuilderImageTag: ${{ parameters.appBuilderImageTag }}
      component: ${{ parameters.component }}
      isDevBuild: false

  - template: /.azure-pipelines/templates/steps.immunodata-app-builder.command.yaml
    parameters:
      builderImage: ${{ parameters.appBuilderImageName }}:${{ parameters.appBuilderImageTag }}
      command: >-
        immunocli-next -vvv warm-kernel-daemon
        apply-daemonset
        --application ${{ parameters.component }}
        --image-tag $BUILD_VERSION
        --kernel-class ${{ parameters.kernel_class }}
        --registry immunodata.azurecr.io
        --versionless-name
      name: Deploy warm-kernel-daemon
